Mathematicians are often rightfully skeptical of proofs that rely on extensive computation (e.g., the controversy around the four color theorem~\cite{Walters2004ItAT}).
Nonetheless, many mathematically-interesting theorems have been resolved with the help of computers.
SAT solving in particular has been a powerful tool for mathematics, successfully resolving
Keller's conjecture~\cite{brakensiek2023resolution},
the packing chromatic number of the infinite grid~\cite{Subercaseaux_Heule_2023},
the Pythagorean triples problem~\cite{Heule_2016},
Lam's problem~\cite{21bright_sat_based_resolution_lams_problem},
and one case of the Erd\H{o}s discrepancy conjecture~\cite{konev2014sat}.
Notably, all of these proofs follow the same two-step structure:
\begin{itemize}
\item \textbf{(Reduction)} Show that the mathematical theorem of interest is true if a concrete propositional formula~$\phi$ is unsatisfiable.
\item \textbf{(Solving)} Show that $\phi$ is indeed unsatisfiable.
\end{itemize}

% \footnote{A variant of this procedure uses \emph{satisfying assignments} for $P$ to construct explicit witnesses for the original theorem, but we focus on the unsatisfiable case.}
% \end{itemize}

Formal methods researchers have developed techniques that make the \emph{solving} step reliable, reproducible, and trustworthy.
For example,
modern SAT solvers produce proofs of unsatisfiability in formal proof systems
such as DRAT~\cite{drat-trim14}
that can in turn be checked with verified proof checkers
such as \texttt{cake\_lpr}~\cite{tanVerifiedPropagationRedundancy2023}.
These tools ensure that when a SAT solver declares a formula~$\phi$ to be unsatisfiable, the formula is indeed unsatisfiable.
In contrast, the \emph{reduction} step is not as trustworthy,
as it can use problem-specific mathematical insights that, when left unverified, threaten the correctness of the proof.
A perfect example of a complex reduction can be found in a recent breakthrough in discrete computational geometry due to Heule and Scheucher~\cite{emptyHexagonNumber}.
They constructed (and solved) a formula $\phi$ whose unsatisfiability implies that every set of 30 points in the plane, without three in a common line, must contain an empty convex hexagon.
However, as is common with such results, their reduction argument was only sketched, relied heavily on intuition,
and had several gaps.

% result from Heule and Scheucher~\cite{emptyHexagonNumber} falls into this category.
% They resolve a variant of the Happy Ending Problem,
% in particular that every set of 30 points in general position contains an empty convex hexagon.
% Their proof relies on a complicated reduction to SAT
% involving numerous nontrivial geometric optimizations and symmetry-breaking arguments.

In this paper we complete and formalize their reduction in the Lean theorem prover~\cite{demouraLeanTheoremProver2015}. We do so by connecting existing geometric definitions
in the mathematical proof library \textsf{mathlib}~\cite{The_mathlib_Community_2020}
to the unsatisfiability of a particular SAT instance, thus setting a new standard for verifying results which rely on extensive computation.
Our formalization is publicly available at \url{https://github.com/bsubercaseaux/EmptyHexagonLean/tree/itp2024}.


\subparagraph*{Verification of SAT proofs.}
Formal verification makes the SAT \emph{solving} step trustworthy.
For example, theorem provers and formal methods tools have been used to verify solvers~\cite{10maric_formal_verification_modern_sat_solver_shallow_embedding_isabelle_hol,oeVersatVerifiedModern2012,skotam_creusat_2022}
and proof checkers~\cite{lammichEfficientVerifiedSAT2020,tanVerifiedPropagationRedundancy2023}.
However, the \emph{reduction} step has not received similar scrutiny,
with only a few reductions having been verified.
For instance,
Cruz-Filipe and coauthors~\cite{formalPythagoreanTriples,LPAR-21:Formally_Proving_Boolean_Pythagorean}
used the \textsf{Coq} proof assistant
to verify the reduction of the Pythagorean triples problem~\cite{Heule_2016} to SAT,
and Delemazure and colleagues~\cite{23delemazure_strategyproofness_proportionality_party_approval_multiwinner_elections}
used \textsf{Isabelle/HOL} to
verify SAT-based results in social choice theory
for which minimal unsatisfiable sets of clauses
were too large to extract human-readable proofs.
More generally,
Giljeg\r{a}rd and Wennerbreck~\cite{GilAndWennerbeck} built a \textsf{CakeML} library
of verified SAT encodings,
which they used to write verified SAT reductions for different puzzles,
such as the \emph{N-queens} problem. 
In this paper,
we use reduction verification techniques based on those of Codel, Avigad, and Heule~\cite{Cayden},
which they developed in Lean.

Formal verification for SAT-based combinatorial geometry
was pioneered by Marić~\cite{19maric_fast_formal_proof_erdos_szekeres_conjecture_convex_polygons_most_six_points}.
He formally verified a reduction of a case of the Happy Ending Problem (see below) to SAT in \textsf{Isabelle/HOL}.
We compare our work to his in~\Cref{sec:related-work}.

\subparagraph*{Lean.}
Initially developed by Leonardo de Moura in 2013~\cite{demouraLeanTheoremProver2015},
the Lean theorem prover has become a popular choice for formalizing modern mathematical research.
Recent successes include the~\emph{Liquid Tensor Experiment}~\cite{Castelvecchi2021}
and the proof of the polynomial Freiman-Ruzsa conjecture~\cite{gowers2023conjecture, slomanATeamMathProves2023},
both of which brought significant attention to Lean.
A major selling point for Lean is the \textsf{mathlib} project~\cite{The_mathlib_Community_2020},
a monolithic formalization of foundational mathematics.
By relying on \textsf{mathlib} for definitions, lemmas, and proof tactics,
mathematicians can focus on the interesting components of a formalization
while avoiding duplication of proof efforts.
In turn, by making a formalization compatible with \textsf{mathlib},
future proof efforts can rely on work done today.
In this spirit, we connect our results to~\textsf{mathlib} as much as possible.

\subparagraph*{The Empty Hexagon Number.}
In the 1930s,
Erd\H{o}s and Szekeres, inspired by Esther Klein, showed that for any $k \geq 3$,
one can find a sufficiently large number $n$
such that every $n$ points in the plane in \emph{general position}
(i.e., with no three points collinear)
contain a convex \emph{$k$-gon}, i.e., a convex polygon with $k$ vertices~\cite{35erdos_combinatorial_problem_geometry}.
The minimal such $n$ is denoted $g(k)$.
The same authors later showed that $g(k) > 2^{k-2}$
and conjectured that this bound is tight~\cite{60erdos_some_extremum_problems_elementary_geometry}.
Indeed, it is known that $g(5) = 9$ and $g(6) = 17$,
with the latter result obtained by Szekeres and Peters 71 years after the initial conjecture
via exhaustive computer search~\cite{06szekeres_computer_solution_17_point_erdos_szekeres_problem}.
Larger cases remain open,
with $g(k) \leq 2^{k+o(k)}$ being the best known upper bound~\cite{suk2017erdos,holmsen2017two}.
This problem is now known as the \emph{Happy Ending Problem},
as it led to the marriage of Klein and Szekeres.

In a similar spirit,
Erd\H{o}s defined $h(k)$
to be the minimal number of points in general position
that is guaranteed to contain a \emph{$k$-hole},
or \emph{empty $k$-gon},
meaning a convex $k$-gon with no other point inside.
It is easy to check that $h(3) = 3$ and $h(4) = 5$.
In 1978, Harborth established that $h(5) = 10$~\cite{Harborth1978}.
Surprisingly, in 1983, Horton discovered constructions of arbitrarily large point sets that
avoid $k$-holes for $k \geq 7$~\cite{hortonSetsNoEmpty1983}.
Only $h (6)$ remained.
The \emph{Empty Hexagon Theorem},
establishing $h(6)$ to be finite,
was proven independently by Gerken~\cite{gerkenEmptyConvexHexagons2008} and Nicolás~\cite{nicolasEmptyHexagonTheorem2007} in 2006.
In 2008, Valtr narrowed the range of possible values down to $30 \leq h(6) \leq 1717$,
where the problem remained until the breakthrough by Heule and Scheucher~\cite{emptyHexagonNumber},
who used a SAT solver to prove that $h(6) \leq 30$,
a result we refer to as the \emph{Empty Hexagon Number}.
