We will incrementally build sufficient machinery to prove:

\begin{theorem*}
Any finite set of $30$ or more points in the plane in general position contains a $6$-hole.
\end{theorem*}

We begin in~\Cref{sec:geometry} by precisely stating the above theorem,
    and the geometric terms involved, in Lean.


\begin{proof}[Outline of the proof]
In a nutshell, the proof consists of building a CNF formula $\phi_n$ such that 
from any set $S$ of $n$ points in general position without a $6$-hole we can construct a satisfying assignment $\tau_S$ for $\phi_n$.
Then, checking that $\phi_{30}$ is unsatisfiable implies that no such set $S$ exists, thus implying the theorem. 

In order to construct $\phi_n$, one must first discretize the continuous space $\mathbb{R}^2$. \emph{Triple orientations}, presented in~\Cref{sec:triple-orientations}, are a way to achieve this. Concretely, any three points $p,q,r$, in general position, correspond to either a clockwise turn, denoted by $\sigma(p, q, r) = -1$, or a counterclockwise turn, denoted by $\sigma(p, q, r) = +1$, depending on whether $r$ is above the line $\vec{pq}$ or not. 
This way, every set $S$ of points in general position induces an assignment $\sigma_S: S^3 \to \{-1,+1\}$
of triple orientations, and as we show in~\Cref{sec:triple-orientations}, whether $S$ contains a $k$-hole or not (i.e., \lstinline|HasConvexEmptyKgon k S|) depends entirely on $\sigma_S$. 
As each orientation $\sigma(p, q, r)$ can only take two values, we can represent each orientation $\sigma(p,q,r)$ with a boolean variable. This way, any set of points $S$ in general position induces an assignment $\tau_S$ over its \emph{orientation variables}. 
Because \lstinline|HasConvexEmptyKgon k S| depends only on $\sigma_S$, it can be written as a boolean formula over the orientation variables.
% \[ 
%     \exists S : \text{set of points in general position without a } k\text{-hole} \implies   
% \]

% Therefore, $\phi_n$ can be constructed by writting the statement 
% \[
% \exists \sigma_S : S^3 \to \{-1,+1\}, \text{ such that } \neg \text{\lstinline|HasConvexEmpty6gon S|}[\sigma_S]    
% \]

Unfortunately, it would be practically unfeasible to determine if such a formula is satisfiable or not with a naïve encoding.
In order to allow for a better encoding,~\Cref{sec:symmetry-breaking} shows that one can assume, without loss of generality, that the set of points $S$ is in \emph{canonical position}.
Canonicity eliminates a number of symmetries from the problem --
ordering, rotation, and mirroring --
significantly reducing the search space.
In~\Cref{sec:encoding}, we show the correctness of the efficient encoding of Heule and Scheucher~\cite{emptyHexagonNumber} for constructing
a small CNF formula $\phi_n$. Concretely, we show that any finite set of $n$ points in canonical position
containing no $6$-hole
would give rise to a propositional assignment $\tau_S$ satisfying $\phi_n$.
However, $\phi_{30}$ (depicted in~\Cref{fig:full-encoding}) is unsatisfiable;
therefore no such set of size $30$ exists
and the theorem follows by contradiction.
The construction of $\phi_n$ and $\tau_S$
involves sophisticated optimizations
which we justify using geometric arguments.
\end{proof}
% file-local attic:

%We compare our work with its closest precedent due to Marić~\cite{19maric_fast_formal_proof_erdos_szekeres_conjecture_convex_polygons_most_six_points}
%in~\Cref{sec:related-work}.
%We conclude in~\Cref{sec:conclusions} by discussing next steps
%towards the formal verification of other Erd\H{o}s-Szekeres-type problems.

% Then,~\Cref{sec:empty-triangle} presents how the previous elements are already enough
% to formalize a SAT-based proof for the \emph{Empty Triangle Theorem},
% a much simpler problem involving only triangles.

% Namely, that one can assume without loss of generality the following two properties at the same time: (i) points are labeled from left to right without two of them having the same $x$-coordinate, and (ii) the triples $(p_1, p_i, p_j)$ are always oriented counterclockwise for $i < j$.
